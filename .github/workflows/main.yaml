name: view_model Workflow

on:
  push:
    branches:
      - main

jobs:
  codecov-upload:
    runs-on: self-hosted  # æŒ‡å®šä½œä¸šè¿è¡Œåœ¨è‡ªæ‰˜ç®¡è¿è¡Œå™¨ä¸Š
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: ğŸ‘· Install Dependencies
        timeout-minutes: 1
        run: |
          fvm dart pub get

      - name: ğŸ” Check format
        timeout-minutes: 1
        run: fvm dart format --set-exit-if-changed -l 80 -o none lib/

      - name: ğŸ“ˆ Check analyzer
        timeout-minutes: 1
        run: fvm dart analyze --fatal-infos --fatal-warnings lib/

      #- name: ğŸŒ Setup Chrome
      #  uses: browser-actions/setup-chrome@latest

      - name: ğŸ§ª Run tests
        timeout-minutes: 2
        run: |
          fvm dart run coverage:test_with_coverage -fb -o coverage -- \
            --concurrency=6 --platform vm --coverage=./coverage --reporter=expanded test/ws_test.dart

      - name: ğŸ“¥ Upload coverage to Codecov
        timeout-minutes: 1
        uses: codecov/codecov-action@v5
        with:
          token: ${{ secrets.CODECOV_TOKEN }}