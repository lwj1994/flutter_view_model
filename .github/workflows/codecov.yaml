name: view_model Workflow

on:
  push:
    branches:
      - main
      - develop

jobs:
  codecov-upload:
    runs-on: self-hosted  # Specify job runs on self-hosted runner
    defaults:
      run:
        working-directory: packages/view_model
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: ğŸ‘· Install Dependencies
        timeout-minutes: 1
        run: |
          puro dart --version
          puro dart pub get

      - name: ğŸ” Check format
        timeout-minutes: 1
        run: puro dart format --set-exit-if-changed -l 80 -o none lib/

      - name: ğŸ“ˆ Check analyzer
        timeout-minutes: 1
        run: puro dart analyze --fatal-infos --fatal-warnings lib/

      #- name: ğŸŒ Setup Chrome
      #  uses: browser-actions/setup-chrome@latest

      - name: ğŸ§ª Run tests
        timeout-minutes: 2
        run: |
          puro flutter test --coverage test

      - name: ğŸ“¥ Upload coverage to Codecov
        timeout-minutes: 1
        uses: codecov/codecov-action@v5
        with:
          token: ${{ secrets.CODECOV_TOKEN }}
          files: packages/view_model/coverage/lcov.info
